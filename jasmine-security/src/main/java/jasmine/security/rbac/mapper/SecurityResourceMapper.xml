<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jasmine.security.rbac.mapper.SecurityResourceMapper">

    <resultMap id="securityFunctionBaseInfoDTO" type="jasmine.security.rbac.dto.SecurityFunctionBaseInfoDTO">
    </resultMap>

    <select id="listFunctionBaseInfoDTOsById" resultMap="securityFunctionBaseInfoDTO">
        select
        t_outer.function_id,
        t_outer.function_code,
        t_outer.function_name
        from (
        <!-- 查询被间接授予给的功能  -->
        (
        select
        t_resource.id resource_id,
        t_resource.access_method,
        t_resource.resource_path
        from sec_function t_function
        sec_function_permission_rel t_function_permission_rel,
        sec_permission_resource_rel t_permission_resource_rel
        where t_function.id = sec_function_permission_rel.function_id
        and sec_function_permission_rel.permission_id = sec_permission_resource_rel.permission_id
        and sec_permission_resource_rel.resource_id = #{resource_id}
        )
        <!-- END 查询被间接授予给的功能 -->
        union all
        <!-- 查询被直接授予给的功能 -->
        (
        select
        t_resource.id resource_id,
        t_resource.access_method,
        t_resource.resource_path
        from sec_function t_function
        sec_function_resource_rel t_function_resource_rel
        where t_function.id = sec_function_resource_rel.function_id
        and t_function_resource_rel = #{resource_id}
        )
        <!-- END 查询被直接授予给的功能 -->
        ) t_outer
        group by t_outer.function_id, t_outer.function_code, t_outer.function_name
        order by t_outer.function_code asc
    </select>

</mapper>